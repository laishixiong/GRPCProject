<!DOCTYPE html>
<!-- saved from url=(0076)https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/servermain.html -->
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths" lang="en" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Write the Server main entry — gRPC Chatroom Workshop  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="./exercise2-servermain_files/custom.css" type="text/css">
  <link rel="stylesheet" href="./exercise2-servermain_files/pygments.css" type="text/css">
    <link rel="index" title="Index" href="https://retroryan8080.gitlab.io/grpc-java-workshop/genindex.html">
    <link rel="search" title="Search" href="https://retroryan8080.gitlab.io/grpc-java-workshop/search.html">
    <link rel="next" title="Run the Server" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/runserver.html">
    <link rel="prev" title="Implement Server Stub" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/serverstub.html"> 

  
  <script src="./exercise2-servermain_files/modernizr.min.js.download"></script><style type="text/css">
:root .btn[href*="/viphktv.com/"],
:root .btn[href*=".papa9394.com"],
:root .btn.btn-success.text-white[href*=".com:"]
{ display: none !important; }</style>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html" class="icon icon-home"> gRPC Chatroom Workshop
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://retroryan8080.gitlab.io/grpc-java-workshop/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/setup/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise1/exercise1.html">Exercise 1 - Basics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/exercise2.html"><span class="toctree-expand"></span>Exercise 2 - Implement Stubs</a><ul class="">
<li class="toctree-l2"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/serverstub.html">Implement Server Stub</a></li>
<li class="toctree-l2 current"><a class="reference internal current" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/servermain.html#">Write the Server main entry</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/runserver.html">Run the Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/exercise3.html">Exercise 3 - Testing the Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise4/exercise4.html">Exercise 4 - Bidirectional Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise5/exercise5.html">Exercise 5 - Deployment to Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise6/exercise6.html">Exercise 6 - Metadata and Interceptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise7/exercise7.html">Exercise 7 - Context Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise8/exercise8.html">Exercise 8 - Tracing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html">gRPC Chatroom Workshop</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html">Docs</a> »</li>
        
          <li><a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/exercise2.html">Exercise 2 - Implement Stubs</a> »</li>
        
      <li>Write the Server main entry</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/_sources/exercise2/servermain.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="write-the-server-main-entry">
<h1>Write the Server main entry<a class="headerlink" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/servermain.html#write-the-server-main-entry" title="Permalink to this headline">¶</a></h1>
<p>In <cite>auth-service/src/main/java/AuthServer.java</cite>’s <cite>main()</cite> method:</p>
<ol class="arabic simple">
<li>Use <cite>ServerBuilder</cite> to build a new server that listens on port 9091</li>
<li>Add an instance of <cite>AuthServiceImpl</cite> as a service: <cite>builder.addService(…)</cite></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Use ServerBuilder to create a new Server instance. Start it, and await termination.</span>
<span class="go">// Algorithm and "auth-issuer" are used for JWT signing and verification.</span>
<span class="go">Algorithm algorithm = Algorithm.HMAC256("secret");</span>
<span class="go">Server server = ServerBuilder.forPort(9091)</span>
<span class="go">  .addService(new AuthServiceImpl(repository, "auth-issuer", algorithm))</span>
<span class="go">  .build();</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Add a shutdown hook to shutdown the server in case the process receives shutdown signal. This will try to shutdown the server gracefully, if shutdown hook is called.</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Runtime.getRuntime().addShutdownHook(new Thread() {</span>
<span class="go">  @Override</span>
<span class="go">  public void run() {</span>
<span class="go">    server.shutdownNow();</span>
<span class="go">  }</span>
<span class="go">});</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Start the server:</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server.start();</span>
<span class="go">logger.info("Server started on port 9091");</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Server will be running in a background thread. Call server.awaitTermination() to block the main thread</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">server.awaitTermination();</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/runserver.html" class="btn btn-neutral float-right" title="Run the Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/serverstub.html" class="btn btn-neutral" title="Implement Server Stub" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        © Copyright 2017, Ryan Knight, Ray Tsang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="./exercise2-servermain_files/jquery.js.download"></script>
      <script type="text/javascript" src="./exercise2-servermain_files/underscore.js.download"></script>
      <script type="text/javascript" src="./exercise2-servermain_files/doctools.js.download"></script>

  

  <script type="text/javascript" src="./exercise2-servermain_files/theme.js.download"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 


</body></html>