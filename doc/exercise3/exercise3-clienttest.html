<!DOCTYPE html>
<!-- saved from url=(0076)https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html -->
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths" lang="en" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Testing from the Client — gRPC Chatroom Workshop  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="./exercise3-clienttest_files/custom.css" type="text/css">
  <link rel="stylesheet" href="./exercise3-clienttest_files/pygments.css" type="text/css">
    <link rel="index" title="Index" href="https://retroryan8080.gitlab.io/grpc-java-workshop/genindex.html">
    <link rel="search" title="Search" href="https://retroryan8080.gitlab.io/grpc-java-workshop/search.html">
    <link rel="next" title="Run the Client" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clientrun.html">
    <link rel="prev" title="Exercise 3 - Testing the Client" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/exercise3.html"> 

  
  <script src="./exercise3-clienttest_files/modernizr.min.js.download"></script><style type="text/css">
:root .btn[href*="/viphktv.com/"],
:root .btn[href*=".papa9394.com"],
:root .btn.btn-success.text-white[href*=".com:"]
{ display: none !important; }</style>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html" class="icon icon-home"> gRPC Chatroom Workshop
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://retroryan8080.gitlab.io/grpc-java-workshop/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/setup/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise1/exercise1.html">Exercise 1 - Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise2/exercise2.html">Exercise 2 - Implement Stubs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/exercise3.html"><span class="toctree-expand"></span>Exercise 3 - Testing the Client</a><ul class="">
<li class="toctree-l2 current"><a class="reference internal current" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#"><span class="toctree-expand"></span>Testing from the Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#implement-the-init-auth-service">Implement the Init Auth Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#implement-authenticate">Implement <cite>authenticate(…)</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clientrun.html">Run the Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/deadlines.html">Deadlines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise4/exercise4.html">Exercise 4 - Bidirectional Streaming</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise5/exercise5.html">Exercise 5 - Deployment to Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise6/exercise6.html">Exercise 6 - Metadata and Interceptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise7/exercise7.html">Exercise 7 - Context Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise8/exercise8.html">Exercise 8 - Tracing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html">gRPC Chatroom Workshop</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="https://retroryan8080.gitlab.io/grpc-java-workshop/index.html">Docs</a> »</li>
        
          <li><a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/exercise3.html">Exercise 3 - Testing the Client</a> »</li>
        
      <li>Testing from the Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/_sources/exercise3/clienttest.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-from-the-client">
<h1>Testing from the Client<a class="headerlink" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#testing-from-the-client" title="Permalink to this headline">¶</a></h1>
<p>Let’s test it from a client.</p>
<p>Open <cite>chat-cli-client/src/main/java/com/example/chat/ChatClient.java</cite></p>
<div class="section" id="implement-the-init-auth-service">
<h2>Implement the Init Auth Service<a class="headerlink" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#implement-the-init-auth-service" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>First, implement initAuthService() method:</li>
</ol>
<p>Use a <cite>ManagedChannelBuilder</cite> to create a new <cite>ManagedChannel</cite> and assign it to <cite>authChannel</cite>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Build a new ManagedChannel</span>
<span class="go">authChannel = ManagedChannelBuilder.forTarget("localhost:9091")</span>
<span class="go">  .usePlaintext()</span>
<span class="go">  .build();</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Instantiate a new blocking stub and assign it to authService:</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Get a new Blocking Stub</span>
<span class="go">authService = AuthenticationServiceGrpc.newBlockingStub(authChannel);</span>
</pre></div>
</div>
</div>
<div class="section" id="implement-authenticate">
<h2>Implement <cite>authenticate(…)</cite><a class="headerlink" href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clienttest.html#implement-authenticate" title="Permalink to this headline">¶</a></h2>
<p>This method will be called when you start the client and initiate the login process:</p>
<ol class="arabic simple">
<li>Call <cite>authService.authenticate(…)</cite> to retrieve the token</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Call authService.authenticate(...) and retreive the token</span>
<span class="go">AuthenticationResponse authenticationReponse = authService.authenticate(AuthenticationRequest.newBuilder()</span>
<span class="go">  .setUsername(username)</span>
<span class="go">  .setPassword(password)</span>
<span class="go">  .build());</span>

<span class="go">String token = authenticationReponse.getToken();</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Once retrieved the token, call <cite>authService.authorization(…)</cite> to retrieve all roles, and print them out</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Retrieve all the roles with authService.authorization(...) and print out all the roles</span>
<span class="go">AuthorizationResponse authorizationResponse = authService.authorization(AuthorizationRequest.newBuilder()</span>
<span class="go">  .setToken(token)</span>
<span class="go">  .build());</span>
<span class="go">logger.info("user has these roles: " + authorizationResponse.getRolesList());</span>
</pre></div>
</div>
<p>Finally, return the token</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// TODO Return the token</span>
<span class="go">return token;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>If any <cite>StatusRuntimeException</cite> is caught, handle it, print the error, and then return null</li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">try {</span>
<span class="go">  ...</span>
<span class="go">} catch (StatusRuntimeException e) {</span>
<span class="go">  // TODO Catch StatusRuntimeException, because there could be Unauthenticated errors.</span>
<span class="go">  if (e.getStatus().getCode() == Status.Code.UNAUTHENTICATED) {</span>
<span class="go">    logger.log(Level.SEVERE, "user not authenticated: " + username, e);</span>
<span class="go">  } else {</span>
<span class="go">    logger.log(Level.SEVERE, "caught a gRPC exception", e);</span>
<span class="go">  }</span>
<span class="go">  // TODO If there are errors, return null</span>
<span class="go">  return null;</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/clientrun.html" class="btn btn-neutral float-right" title="Run the Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="https://retroryan8080.gitlab.io/grpc-java-workshop/exercise3/exercise3.html" class="btn btn-neutral" title="Exercise 3 - Testing the Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        © Copyright 2017, Ryan Knight, Ray Tsang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="./exercise3-clienttest_files/jquery.js.download"></script>
      <script type="text/javascript" src="./exercise3-clienttest_files/underscore.js.download"></script>
      <script type="text/javascript" src="./exercise3-clienttest_files/doctools.js.download"></script>

  

  <script type="text/javascript" src="./exercise3-clienttest_files/theme.js.download"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 


</body></html>